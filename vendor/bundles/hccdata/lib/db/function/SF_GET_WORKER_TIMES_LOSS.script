create or replace
FUNCTION           SF_GET_WORKER_TIMES_LOSS
(
    WORKER_TIME_ID    IN    VARCHAR2
)
 RETURN number IS 
 RESULT         NUMBER := 0;
 RESULT1        NUMBER := 0;
 RESULT2        NUMBER := 0;
 V_WORK_DATE    VARCHAR2(10) := '';
 D_START_TIME   DATE;
 D_END_TIME     DATE;
 
BEGIN

  SELECT TO_CHAR(WORK_DATE, 'YYYY-MM-DD') INTO V_WORK_DATE FROM WORKER_TIMES WHERE ID = WORKER_TIME_ID;
       
  SELECT START_TIME INTO D_START_TIME FROM WORKER_TIMES WHERE ID = WORKER_TIME_ID;
  
  SELECT END_TIME INTO D_END_TIME FROM WORKER_TIMES WHERE ID = WORKER_TIME_ID;
  
  -- 시작시간과 종료시간의 날짜가 다르면 
  IF TO_CHAR(D_START_TIME, 'YYYY-MM-DD') != TO_CHAR(D_END_TIME, 'YYYY-MM-DD') THEN
    -- 1. 시작시간은 그대로 종료시간은 그 날 23:59:59 시간까지로 설정하여 LOSS_TERM을 한 번 구한다.
    SELECT TO_DATE((V_WORK_DATE || ' 23:59:59'), 'YYYY-MM-DD HH24:MI:SS') INTO D_END_TIME FROM DUAL;
    SELECT SF_GET_WORKER_LOSS(WORKER_TIME_ID, V_WORK_DATE, D_START_TIME, D_END_TIME) INTO RESULT1 FROM DUAL;
    
    -- 2. 시작시간은 다음날 00:00:00으로 종료시간은 그대로 설정하여 LOSS_TERM을 한 번 더 구한다.
    SELECT TO_CHAR((WORK_DATE + 1), 'YYYY-MM-DD') INTO V_WORK_DATE FROM WORKER_TIMES WHERE ID = WORKER_TIME_ID;
    SELECT TO_DATE((V_WORK_DATE || ' 00:00:00'), 'YYYY-MM-DD HH24:MI:SS') INTO D_START_TIME FROM DUAL;
    SELECT END_TIME INTO D_END_TIME FROM WORKER_TIMES WHERE ID = WORKER_TIME_ID;
    SELECT SF_GET_WORKER_LOSS(WORKER_TIME_ID, V_WORK_DATE, D_START_TIME, D_END_TIME) INTO RESULT2 FROM DUAL;
    
    -- 3, 두 합을 더한 값을 결과로 리턴
    SELECT (DECODE(RESULT1, NULL, 0, RESULT1) + DECODE(RESULT2, NULL, 0, RESULT2)) INTO RESULT FROM DUAL;
  ELSE
    SELECT SF_GET_WORKER_LOSS(WORKER_TIME_ID, TO_CHAR(D_START_TIME, 'YYYY-MM-DD'), D_START_TIME, D_END_TIME) INTO RESULT FROM DUAL;
  END IF;
   
 RETURN(RESULT);

EXCEPTION    
    WHEN OTHERS THEN
      RETURN -1;
END SF_GET_WORKER_TIMES_LOSS;