o: ActiveSupport::Cache::Entry	:@compressedF:@created_atf1408003178.576:@expires_in0:@value"­[I"Ÿ/*
 * Mixin Lockì€ ë™ê¸°í™”ëœ ì²˜ë¦¬ë¥¼ ìœ„í•œ ë°©ë²•ì„ ì œê³µí•œë‹¤.
 * TODO ë‹¨ìœ„í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±.
 * ì˜ˆì‹œ.		
 * - ì•„ë˜ ì˜ˆì‹œëŠ” ëª¨ë“  Lockëœ Functionë“¤ì´ ì²˜ë¦¬ëœ ë‹¤ìŒì—, readyì— ë“±ë¡í•œ Functionì´ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.
		// 1. Lock ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
		var lock = SF.createLock();
		
		// 2. Array í˜•íƒœì˜ ëŒ€ìƒì— ëŒ€í•´ì„œ, ìˆœì°¨ì ìœ¼ë¡œ Lockì„ ì ìš©í•˜ì—¬ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
		lock.each([1, 2, 3, 4, 5], function(n, l) {
			setTimeout(function() {
				Ext.log(n);
				l.release();
			}, 1000);
		});

		// 3. ê°œë³„ Functionì— ëŒ€í•´ì„œ Lockì„ ì ìš©í•  ìˆ˜ ìˆë‹¤.
		lock.lock();
		setTimeout(function() {
			Ext.log('3000');
			lock.release();
		}, 3000);
		
		// 4. ì•ì—ì„œ ì ìš©ëœ Lockì´ ëª¨ë‘ ë¦´ë¦¬ì¦ˆ ë˜ëŠ” ì‹œì ì— ì²˜ë¦¬ë  Functionì€ ready ë©”ì˜ë“œì— ë“±ë¡í•œë‹¤.
		lock.ready(function() {
			Ext.log('Executed');
		});

 */


Ext.define('mixin.Lock', function() {
	function Lock() {
		this.count = 0;
		this.valid = true;
	}

	Lock.prototype.invalidate = function() {
		this.valid = false;
	};

	Lock.prototype.lock = function() {
		if (!this.valid)
			return;

		this.count++;
	};

	/*
	 * Lock.release(..) Lockì„ release ì‹œí‚¤ë©´ì„œ, ê³„ì† ì§„í–‰í•  ê²ƒì¸ì§€ ë˜ëŠ”, ë” ì´ìƒ ì§„í–‰í•˜ì§€ ì•Šì„ ê²ƒì¸ì§€ë¥¼
	 * argumentë¡œ ê²°ì •í•  ìˆ˜ ìˆë‹¤.
	 */
	Lock.prototype.release = function(keepGoing) {
		if (!this.valid)
			return;

		if (keepGoing === false) {
			if (this.doneFn)
				this.doneFn();
			this.invalidate();

			return;
		}

		this.count = this.count - 1;
		if (0 < this.count)
			return;

		try {
			if (this.readyFn) {
				this.readyFn();
			}
		} finally {
			if (this.doneFn) {
				this.doneFn();
			}
		}
	};

	/*
	 * Lock release(true/false)ì— ê´€ê³„ì—†ì´ í•­ìƒ ì‹¤í–‰ë˜ëŠ” ë¡œì§. ready()ì— ë“±ë¡ëœ functionì´ ì‹¤í–‰ëœ í›„ì—
	 * ì‹¤í–‰ëœë‹¤.
	 */
	Lock.prototype.done = function(fn, scope, args) {
		if (!this.valid)
			return;

		this.doneFn = function() {
			fn.apply(scope || this, args || []);
		};
	};

	/*
	 * Lock release(false)ì¸ ê²½ìš°ì—ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ë¡œì§ì„.
	 */
	Lock.prototype.ready = function(fn, scope, args) {
		if (!this.valid)
			return;

		if (this.count > 0) {
			this.readyFn = function() {
				fn.apply(scope || this, args || []);
			};

			return;
		}

		try {
			fn.apply(scope || this, args || []);
		} finally {
			if (this.doneFn)
				this.doneFn();
		}
	};

	Lock.prototype.reset = function() {
		this.count = 0;
		this.valid = true;

		delete this.readyFn;
		delete this.doneFn;
	};

	Lock.prototype.each = function(array, fn, scope, args) {
		if (!this.valid)
			return;

		this.lock();
		if (array.length === 0) {
			this.release();
			return;
		}

		var lock = new Lock();
		lock.lock();

		try {
			fn.call(scope || this, array[0], lock, args || []);
		} finally {
			/*
			 * fn ë‚´ì—ì„œ ë°”ë¡œ lock.release(false) í•œ ê²½ìš°ì— ëŒ€í•œ ì²˜ë¦¬.
			 */
			if (!lock.valid) {
				this.release();
				return;
			}
		}

		var self = this;
		lock.done(function() {
			self.release();
		});

		lock.ready(function() {
			self.each(array.slice(1), fn, scope, args);
		}, this, args);
	};

	return {
		createLock : function() {
			return new Lock();
		}
	};
}());
:ET